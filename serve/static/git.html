<!DOCTYPE html>
<link rel="stylesheet" href="/style.css" />
<link rel="stylesheet" href="/git_style.css" />
<script type="module" src="/xyt.js"></script>
<h1>git</h1>
<div x-app>
	<h2>current head</h2>
	<div
		class="icon-and-text"
		x-data="fetch('api/repository/head/name').then(r=>r.json()).then(j=>import('/git.js').then(g=>g.parseRef(j)))"
	>
		<svg class="icon"><use :href="refSym(type)"></use></svg>
		<span x-text="name"></span>
	</div>
	<h2>all refs</h2>
	<ul
		class="semantic-ul"
		x-data="fetch('api/reference/list').then(r=>r.json()).then(j=>import('/git.js').then(g=>j.map(g.parseRef)))"
	>
		<li class="icon-and-text" x-for="$data">
			<svg class="icon"><use :href="refSym(type)"></use></svg>
			<span x-text="name"></span>
		</li>
	</ul>
	<h2>changed files</h2>
	<ul class="semantic-ul" x-data="fetch('api/status').then(r=>r.json())">
		<li class="icon-and-text" x-for="$data" x-class="diffClass(type)">
			<svg class="icon"><use :href="worktreeSym(type)"></use></svg>
			<svg class="icon"><use :href="indexSym(type)"></use></svg>
			<span
				x-text="
          index_to_workdir?.new_file.path ?? index_to_workdir?.old_file.path ??
          head_to_index?.new_file.path ?? head_to_index?.old_file.path
        "
			></span>
		</li>
	</ul>
</div>
<script>
	const sym = (s) => "/git_icons.svg#symbol-" + s;
	const refSym = (t) => sym("ref-" + t.replace(/_/g, "-"));
	const diffClass = (t) =>
		"status-" + t.replace(/^worktree_|^index_/, "").replace(/_/g, "-");
	const worktreeSym = (t) =>
		sym(
			t.startsWith("index_")
				? "blank"
				: "file-" + t.replace(/^worktree_/, "").replace(/_/g, "-")
		);
	const indexSym = (t) =>
		sym(
			t.startsWith("worktree_")
				? "blank"
				: "file-" + t.replace(/^index_/, "").replace(/_/g, "-")
		);
</script>
